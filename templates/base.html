<!DOCTYPE html>
<html lang="de">
{% load static %}
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
    <link rel="stylesheet" href="{% static 'css/menu.css' %}">
    <meta name="csrf-token" content="{{ csrf_token }}">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script> <!-- Um Ajax zu nutzen -->
    <title>{% block title %}{% endblock %}Seeker</title>
</head>
<body>
    
    <nav class="flex main-menu">
        <div>
            <a class="logo" href="{% url 'home' %}">Seeeker</a>
        </div>

        <div class="flex">
            {% if user.is_authenticated %}
                <a class="profile" href="{% url 'profile_detail' pk=request.user.id %}">Mein Profil</a>
                <a class="logout" href="{% url 'logout' %}">Logout</a>

                <!-- Notifications Menü -->
                <div id="notificationArea" class="notification-area">
                    <button id="notificationButton">Benachrichtigungen</button>
                    <div id="notificationDropdown" class="notification-dropdown">
                        <!-- noticications werden dann hier angezeigt -->
                    </div>
                </div>

            {% else %}
                <a href="{% url 'login' %}">Login</a>
                <a href="{% url 'signup' %}">Registrieren</a>
            {% endif %}
        </div>
        <div id="burger-menu">
            <div class="line"></div>
            <div class="line"></div>
            <div class="line"></div>
        </div>
    </nav>

    <div class="side-bar">
        <nav class="flex-wrap-container">
            {% if user.is_authenticated %}
                <a href="{% url 'profile_detail' pk=request.user.id %}">Mein Profil</a>

                <a href="{% url 'profile_list' %}">Alle User</a>
                <a href="{% url 'profile_edit' %}">Profil bearbeiten</a>
                <a href="{% url 'user_filter' %}">Seeeeeek</a>
                <a href="{% url 'add_terms' %}">Wörterliste++ (nur für uns)</a>
                
                <a href="{% url 'rooms' %}">Chatrooms</a> 

                <a class="logout" href="{% url 'logout' %}">Logout</a>
            {% else %}
                <a href="{% url 'login' %}">Login</a>
                <a href="{% url 'signup' %}">Registrieren</a>
            {% endif %}
        </nav>
    </div>
    

    <div class="row">
        {% block content %}

        {% endblock content %}
    </div>

    {% block scripts %}
    {% endblock scripts %}

    <script>
        // JavaScript für Dropdownmenue

        var sideBar = document.querySelector('.side-bar');

        document.getElementById('burger-menu').onclick = function(e){
            sideBar.classList.toggle('slide');
        }
    </script>


    <script>
        // Javascript für notifications 

        {% if user.is_authenticated %}
        const notificationSocket = new WebSocket(
            'ws://' + window.location.host + '/ws/notifications/'
        );
    
        notificationSocket.onmessage = function(e) {
            const data = JSON.parse(e.data);
    
            if (data.type === 'notification') {
                displayNotification(data.notification_info, data.notification_link);
            }
        };
    
        notificationSocket.onclose = function(e) {
            console.error('Notification socket closed unexpectedly');
        };
    
        function displayNotification(info, link) {
            var dropdown = document.getElementById("notificationDropdown");
            var notificationElement = document.createElement("div");
            notificationElement.innerHTML = `<a href="${link}">${info}</a>`;
            dropdown.prepend(notificationElement); // fügt benachrichtigung oben in dropdown-lsite hinzu
        }
    
        document.getElementById("notificationButton").onclick = function() {
            var dropdown = document.getElementById("notificationDropdown");
            dropdown.style.display = dropdown.style.display === "none" ? "block" : "none";
        };
        {% endif %}
    </script>

</body>
</html>